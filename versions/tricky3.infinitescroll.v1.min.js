(function(e){e.fn.TrickyInfiniteScroll=function(t){var n={ParentProductsWrapper:null,IsRequestOn:false,NextPageLink:null,PreviousPageLink:null,InitialNextPageLink:null,NeedToLoadOnlyNextPages:false,NeedToLoadOnlyPreviousPages:false,NeedToLoadBothPreviousAndNextPages:false,UrlToLoad:null,UpdateHashOnWindowScrollLoaded:false,Opts:{Selectors:{ParentProductsWrapper:".collection-matrix",Product:"li",NextPageLink:"#NextPaginationLink a",PreviousPageLink:"#PreviousPaginationLink a"},PageQueryStringKey:"page",WaitForImagesToBeLoaded:false,EnableHasherModule:true,CallBack:function(){},CallBackOnPageLoad:function(){},CallBackBeforePageLoad:function(){}}};n.Opts=e.extend(n.Opts,t);n.ParentProductsWrapper=this;n.NextPageLink=e(n.Opts.Selectors.NextPageLink);n.InitialNextPageLink=n.NextPageLink;n.PreviousPageLink=e(n.Opts.Selectors.PreviousPageLink);n.NeedToLoadOnlyNextPages=n.PreviousPageLink.length==0&&n.NextPageLink.length==1;n.NeedToLoadOnlyPreviousPages=n.PreviousPageLink.length==1&&n.NextPageLink.length==0;n.NeedToLoadBothPreviousAndNextPages=n.PreviousPageLink.length==1&&n.NextPageLink.length==1;n.UpdateHashOnWindowScrollLoaded=false;var r=function(){if(n.NextPageLink!=null&&n.NextPageLink.length==1||n.PreviousPageLink!=null&&n.PreviousPageLink.length==1){var t=e(window).scrollTop();var r=t+e(window).height();var o=e(n.Opts.Selectors.Product+":last",n.ParentProductsWrapper).offset().top;var u=o+e(n.Opts.Selectors.Product+":last",n.ParentProductsWrapper).height();if(!n.IsRequestOn&&u<=r&&o>=t){n.Opts.CallBackBeforePageLoad();s.SetUpUrlToLoad();e.get(n.UrlToLoad,i);n.IsRequestOn=true}}else{n.Opts.CallBack();e(window).unbind("scroll.trickyInfiniteScroll")}};var i=function(t){var r=e(t).find(n.Opts.Selectors.ParentProductsWrapper);n.NextPageLink=e(t).find(n.Opts.Selectors.NextPageLink);n.PreviousPageLink=e(t).find(n.Opts.Selectors.PreviousPageLink);if(n.Opts.WaitForImagesToBeLoaded){var i=e("img",r).length;var u=1;e("img",r).load(function(){u++;if(u>=i&&n.IsRequestOn){s.FireAllCallBacks(r)}}).each(function(){if(this.complete)e(this).load()})}else{s.FireAllCallBacks(r)}if(n.Opts.EnableHasherModule&&!n.UpdateHashOnWindowScrollLoaded){n.UpdateHashOnWindowScrollLoaded=true;o.UpdateHashOnWindowScrollStopped()}};var s={FireAllCallBacks:function(e){if(n.Opts.EnableHasherModule){o.HashUrlAndAddPageAttributesToProducts(e)}n.ParentProductsWrapper.append(e.html());s.ReloadPageLinksObjectsAndVariables();n.Opts.CallBackOnPageLoad();n.IsRequestOn=false},AddPageNumberAttributesToExistingProducts:function(){var t=s.GetParameterByName(window.location.href,n.Opts.PageQueryStringKey);e(n.Opts.Selectors.Product,n.ParentProductsWrapper).attr("data-pagenumber",t==""?1:t)},GetParameterByName:function(e,t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n=new RegExp("[\\?&]"+t+"=([^&#]*)"),r=n.exec(e);return r==null?"":decodeURIComponent(r[1].replace(/\+/g," "))},ReloadPageLinksObjectsAndVariables:function(){if(n.NeedToLoadOnlyNextPages&&n.NextPageLink.length==0){n.NeedToLoadOnlyNextPages=false;n.PreviousPageLink=n.NextPageLink=null}if(n.NeedToLoadOnlyPreviousPages&&n.PreviousPageLink.length==0){n.NeedToLoadOnlyPreviousPages=false;n.NextPageLink=n.PreviousPageLink=null}},SetUpUrlToLoad:function(){if(n.NeedToLoadOnlyPreviousPages){n.UrlToLoad=n.PreviousPageLink.attr("href")}if(n.NeedToLoadOnlyNextPages){n.UrlToLoad=n.NextPageLink.attr("href")}if(n.NeedToLoadBothPreviousAndNextPages){if(n.PreviousPageLink.length){n.UrlToLoad=n.PreviousPageLink.attr("href")}else if(n.InitialNextPageLink!=null){n.UrlToLoad=n.InitialNextPageLink.attr("href");n.NeedToLoadOnlyNextPages=true;n.NeedToLoadBothPreviousAndNextPages=false}}}};var o={CheckHashAndReloadPageIfNeeded:function(){var e=window.location.hash;if(e&&e.indexOf(n.Opts.PageQueryStringKey)!=-1){var t=e.split("=")[1];var r=window.location.href.replace(e,"");var i=window.location.search;if(i==""){window.location.href=r+"?"+n.Opts.PageQueryStringKey+"="+t}else{var s=i.replace("?","").split("&");var o="";for(var u=0;u<s.length;u++){if(s[u].indexOf(n.Opts.PageQueryStringKey+"=")==-1){o+=s[u]+"&"}}var r=window.location.href.replace(window.location.hash,"").replace(window.location.search,"");if(o!=""){r=r+"?"+o+n.Opts.PageQueryStringKey+"="+t}else{r=r+"?"+n.Opts.PageQueryStringKey+"="+t}window.location.href=r}}},HashUrlAndAddPageAttributesToProducts:function(t){var r=s.GetParameterByName(n.UrlToLoad,n.Opts.PageQueryStringKey);if(r){e(n.Opts.Selectors.Product,t).attr("data-pagenumber",r);window.location.hash=n.Opts.PageQueryStringKey+"="+r}},UpdateHashOnWindowScrollStopped:function(){e(window).scrollStopped(function(){e(n.Opts.Selectors.Product,n.ParentProductsWrapper).each(function(){if(e(this).visible(true)){e(this).addClass("in-viewport");e(this).removeClass("not-in-viewport")}else{e(this).removeClass("in-viewport");e(this).addClass("not-in-viewport")}});var t=e(n.Opts.Selectors.Product+".in-viewport",n.ParentProductsWrapper).first();if(t.length==1){window.location.hash=n.Opts.PageQueryStringKey+"="+t.attr("data-pagenumber")}})}};if(n.Opts.EnableHasherModule){o.CheckHashAndReloadPageIfNeeded()}s.AddPageNumberAttributesToExistingProducts();e(window).bind("scroll.trickyInfiniteScroll",r)}})(jQuery);(function(e){e.fn.scrollStopped=function(t){e(this).scroll(function(){var n=this,r=e(n);if(r.data("scrollTimeout")){clearTimeout(r.data("scrollTimeout"))}r.data("scrollTimeout",setTimeout(t,250,n))})}})(jQuery);(function(e){e.fn.visible=function(t,n,r){var i=e(this).eq(0),s=i.get(0),o=e(window),u=o.scrollTop(),a=u+o.height(),f=o.scrollLeft(),l=f+o.width(),c=i.offset().top,h=c+i.height(),p=i.offset().left,d=p+i.width(),v=t===true?h:c,m=t===true?c:h,g=t===true?d:p,y=t===true?p:d,b=n===true?s.offsetWidth*s.offsetHeight:true,r=r?r:"both";if(r==="both")return!!b&&m<=a&&v>=u&&y<=l&&g>=f;else if(r==="vertical")return!!b&&m<=a&&v>=u;else if(r==="horizontal")return!!b&&y<=l&&g>=f}})(jQuery)